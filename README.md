# Easy Sniffer
### Network tool for A/D CTF

This tool allow you to automatically start tcpdump session on remote host and save capture files (.pcap) on local machine (inspired by [Kanku-Sho](https://github.com/Shotokhan/kanku-sho))

Thanks to **rsync** it is possibile to transfer quickly files from remote host to local machine

Dependencies:
- python3
- coloredlogs (from pip)
- tcpdump (on remote host)
- rsync (both on local machine and remote host)

### Basic config
All configuration must be done in **_config.json_**
Example:
```json
{
    "connection_info":{
        "vulnbox_ip": "IP_YOUR_VIRTUAL_MACHINE",
        "vulnbox_port" : 22,
        "user" : "root",
        "ssh_key" : "YOUR_SSH_KEY"

    },
    "tcpdump_info": {
        "interface" : "any",
        "remote_pcap_folder" : "",
        "local_pcap_folder" : "",
        "max_packets" : 500,
        "max_size" : 1,
        "packet_name" : "remote_capture",
        "sleep_time" : 15,
        "script_name" : "rename_pcaps"
    }
}
```

### Attention
**Make sure**:
- **rename_pcaps** is present in same the same folder of **_remote_pcap_folder_**
- tcpdump is up to date on remote host
- to execute `aa-complain /bin/tcpdump` on remote host (apt-get install apparmor-utils). This is needed to make `-z postcommand` of tcpdump run properly (error such as permission denied could be issued and packets are not renamed in packetnameXXX.pcap, but remains packetname.pcapXXX - not good for Caronte)
- **rsync** is installed both on local and remote machine

For more information on point (3), look at:
https://ubuntuforums.org/showthread.php?t=1501339
https://answers.launchpad.net/ubuntu/+source/tcpdump/+question/168402

(If you want something easier, you could create a and run a script `auto_rename` using _inotify_ on the remote host which rename packets generated by tcpdump when the latter close the file descriptor.
Or eventually you could use -G instead of -C and use the "timestamp string template" of tcpdump, like `name_%(H)_%(M).pcap`)

### Caronte integration
Thanks to [@eciavatta](https://github.com/eciavatta) it is pretty easy to integrate Caronte. Just use `./feedCaronte .` inside the **local pcap folder** and keep it running.
In order to use it, you need to install `inotify-tools`

### TODO
- [ ] Check if tcpdump is already running on remote host
- [ ] Add better timing for rsync to be called
- [x] Add integration with Caronte and ~~Flower~~ (automatic pcap uploader)
- [ ] Add basic web interface for easy settings management and for basic pcap analyzing (similiar to Flower)
- [ ] Dockerize when finished





